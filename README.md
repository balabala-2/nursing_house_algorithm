# nursing_house_algorithm

## 使用DeepFace 算法库进行人脸检测，情绪识别

Deepface是一个轻量级的人脸识别和面部属性分析(年龄，性别，情感和种族)的python框架。它是一个混合的人脸识别框架，包装了最先进的模型:VGG-Face，谷歌FaceNet, OpenFace, Facebook DeepFace, DeepID, ArcFace, Dlib和SFace。DeepFace提供了可选的多种先进的人脸检测器：'opencv', 'ssd', 'dlib', 'mtcnn', 'retinaface', 'mediapipe’。
本项目中我们选择opencv或ssd，这是因为这两种检测器在速度方面更加具有优越性，本地视频处理速度可达27FPS，能够很好的满足实时的要求。而RetinaFace和MTCNN虽然在检测和校准阶段表现超群，但它们的速度要慢得多。

 

## 使用Mediapipe进行头部姿态估计：
我们发现了一个更好的人脸关键点算法库(实时迅速地估计468个3D人脸地标)--mediapipe。
利用头部姿态估计，我们完成了以下功能创新：
 1.	不同于传统系统的用户简单的做一个动作录入一张图片，我们在进行人脸录入时，我们使用头部姿态估计通过yaw,roll,pitch计算欧拉角判断用户是否完成了向左转，向右转，向上看，向下看等四个指定动作
 2.	通过计算468个关键点中眼睛对应点计算眼宽和眼高的比例来判断是否眨眼，通过计算468个关键点中嘴巴对应点计算嘴宽和嘴高的比例来判断是否张嘴，以此来保证用户图像采集时的准确性。
 

## 人脸录入流程优化：
人脸录入需要用户按照顺序做出相应的动作
如果未做出相应的动作，则不能进行到下一个阶段
解决方案：多线程进行人脸的状态记录，主线程进行视频的推流，子线程对人脸的动作进行判断，只有做出特定的动作，才可以进入到下一个动作的判断。
 
## 使用YOLOv5进行摔倒检测：
YOLO 是“You only look once”的首字母缩写，是一种将图像划分为网格系统的对象检测算法。网格中的每个单元都负责检测自身内部的对象。由于其速度和准确性，YOLO 是最著名的对象检测算法之一。
我们使用对象检测模型 YOLOv5 获取帧中存在的多个人，然后估计每个人的姿势，最后将图像聚合到单个帧中。
在RTX3060 16g上训练30个epoch，训练结果如下，可以看到效果较好（数据集是某个人提摔倒检测识别比赛的数据集）

## 通过语音识别对义工和老人的交互进行判断
单纯的判断人脸之间的距离并不能很好的判断人的交互情况。
解决方案：拉取老人和义工交互视频流中的音频流，然后进行实时的语音识别，然后在义工和老人交互结束之后将识别的文本数据存储到数据库中。
